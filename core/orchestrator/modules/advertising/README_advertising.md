# Advertising Module

**Блок 9 — Управление рекламой Wildberries**

## Назначение модуля

`advertising` — операционный модуль AI-Orchestrator, отвечающий за **управление рекламными кампаниями на Wildberries** и **анализ рекламных метрик** с последующим принятием решений по автостратегиям.

Модуль:

* создаёт, изменяет и управляет рекламными кампаниями WB
* управляет ставками (ручными и автоматическими)
* собирает и агрегирует рекламные метрики
* исполняет автостратегии на основе KPI и аналитики
* публикует доменные и интеграционные события в систему

Модуль **не принимает стратегических решений** — он исполняет команды оркестратора.

---

## Роль в общей архитектуре

```
Strategy → Analytics → Tooling → Orchestrator
                                      ↓
                               Advertising Module
                                      ↓
                               Wildberries API
                                      ↓
                               Events → Analytics
```

`advertising`:

* получает команды от `orchestrator`
* взаимодействует с внешним WB API
* возвращает факты исполнения и метрики в аналитический контур

---

## Поддерживаемые рекламные инструменты WB

* Поиск
* Каталог
* Автоставки
* Кампании CPC / CPA
* Аукционные размещения
* Нормализованные запросы (normquery)

---

## Структура модуля

```
advertising/
├── interface/
├── showcase/
├── services/
└── data-platform/
    ├── api/
    │   ├── queries/
    │   ├── commands/
    │   └── command-log/
    └── connectors/
        ├── inbound/
        │   ├── contracts/
        │   └── events/
        └── outbound/
            ├── contracts/
            └── events/
```

---

## Ответственность слоёв

### `interface/`

UI-слой управления рекламой.

* запуск / пауза / остановка кампаний
* настройка стратегий
* ручное управление ставками
* просмотр статусов и ошибок

⚠️ **Не содержит бизнес-логики**

---

### `showcase/`

Витрина рекламных данных (read-only).

* расходы
* клики
* показы
* CTR / CPC / CPA / ROI
* статусы кампаний

Данные поступают **только из data-platform**.

---

### `services/`

Бизнес-логика управления рекламой.

Содержит:

* применение автостратегий
* расчёт ставок
* принятие решений на основе метрик
* декомпозицию оркестраторских команд в атомарные действия

⚠️ **Каждый сервис — узкоспециализированный, небольшой, независимый**

---

## Data Platform (ядро модуля)

`data-platform` — слой **правил работы с данными**, контрактов и интеграций.

Он:

* изолирует WB API
* нормализует данные
* гарантирует идемпотентность и аудит
* управляет событиями

---

### `api/queries/`

Получение данных из WB API.

Типы данных:

* карточки товаров
* список кампаний
* ставки
* бюджеты
* статистика и метрики

Назначение:

* **только чтение**
* **никакой бизнес-логики**
* каждый query = один тип данных

---

### `api/commands/`

Отправка команд в WB API.

Типы команд:

* создание кампаний
* изменение ставок
* запуск / пауза / стоп
* управление бюджетом
* работа с минус-словами

Принципы:

* атомарность
* идемпотентность
* отсутствие побочных эффектов

---

### `api/command-log/`

Аудит всех отправленных команд.

Фиксирует:

* тип команды
* параметры
* внешний идентификатор
* статус исполнения
* таймстемпы

Используется для:

* ретраев
* восстановления состояния
* анализа ошибок WB API

---

## Коннекторы

### `connectors/inbound/`

#### `contracts/`

Контракты входящих данных:

* команды от orchestrator
* сигналы от analytics
* параметры автостратегий

#### `events/`

Входящие события:

* изменение стратегии
* обновление KPI
* аварийные сигналы

---

### `connectors/outbound/`

#### `contracts/`

Контракты исходящих данных:

* состояние кампаний
* агрегированные метрики
* результаты автостратегий

#### `events/`

Исходящие события:

* campaign.started
* campaign.paused
* bid.updated
* budget.exhausted
* wb.api.error

---

## Внешние API Wildberries

Модуль работает **только через data-platform/api** со следующими endpoint’ами:

### Контент и товары

* content/v2/get/cards/list
* discounts-prices-api/v2/list/goods/filter

### Кампании и управление

* advert/v2/adverts
* adv/v0/start | pause | stop | delete | rename
* adv/v2/seacat/save-ad

### Ставки и аукционы

* advert/v1/bids
* advert/v1/bids/min
* adv/v0/auction/placements
* adv/v0/auction/nms
* adv/v0/normquery/*

### Финансы

* adv/v1/balance
* adv/v1/budget
* adv/v1/budget/deposit
* adv/v1/payments

### Статистика

* adv/v0/normquery/stats
* adv/v3/fullstats

⚠️ **Прямой доступ к WB API вне data-platform запрещён**

---

## Событийная модель

Модуль использует:

* доменные события
* интеграционные события
* async-команды

Все события:

* неизменяемы
* версионируемы
* описываются контрактами

---

## Нефункциональные требования

### Идемпотентность

* все команды должны быть безопасны к повторной отправке
* внешний WB id сохраняется в `command-log`

### Rate Limit и ретраи

* все вызовы WB API учитывают лимиты
* повторные попытки выполняются через command-log

### Аудит и логирование

* логируется каждый command и response
* ошибки WB не теряются
* поддерживается восстановление состояния

---

## Принципы для ИИ-агента (КРИТИЧНО)

* ❗ **Один файл = одна ответственность**
* ❗ **Скрипты ≤ 50–100 строк**
* ❗ **Без сквозной логики**
* ❗ **Без прямых зависимостей между сервисами**
* ❗ **Вся интеграция — через контракты**
* ❗ **Никакой логики в interface и showcase**

---

## Итог

`advertising` — это:

* исполнитель рекламных стратегий
* адаптер к Wildberries
* источник рекламных фактов и событий
* полностью управляемый оркестратором модуль

Модуль является частью **замкнутого интеллектуального контура**, обеспечивая автоматическое, масштабируемое и контролируемое управление рекламой на маркетплейсе.